<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sleep Disorder Predictor</title>

  <style>
    :root{
      --bg: #0b1020;
      --card: rgba(255,255,255,0.08);
      --card2: rgba(255,255,255,0.06);
      --border: rgba(255,255,255,0.12);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.70);
      --muted2: rgba(255,255,255,0.55);
      --shadow: 0 24px 60px rgba(0,0,0,0.35);
      --radius: 18px;
      --good: rgba(0,255,163,0.90);
      --warn: rgba(255,196,0,0.95);
      --bad: rgba(255,120,120,0.95);
    }

    *{ box-sizing: border-box; }
    body{
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
      background:
        radial-gradient(900px 500px at 10% 10%, rgba(124,92,255,0.35), transparent 60%),
        radial-gradient(800px 500px at 90% 20%, rgba(0,196,255,0.25), transparent 60%),
        radial-gradient(700px 500px at 50% 95%, rgba(0,255,163,0.18), transparent 55%),
        var(--bg);
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 28px 14px;
    }

    .wrap{
      width: 100%;
      max-width: 1020px;
    }

    .header{
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 18px;
    }

    .title{
      margin: 0;
      font-size: clamp(1.5rem, 2vw + 1rem, 2.2rem);
      letter-spacing: -0.02em;
    }
    .subtitle{
      margin: 6px 0 0 0;
      color: var(--muted);
      line-height: 1.45;
      max-width: 72ch;
      font-size: 0.98rem;
    }

    .pill{
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: var(--muted);
      font-size: 0.9rem;
      white-space: nowrap;
    }
    .dot{
      width: 10px; height: 10px; border-radius: 50%;
      background: var(--good);
      box-shadow: 0 0 0 4px rgba(0,255,163,0.12);
    }

    .card{
      background: linear-gradient(180deg, var(--card), var(--card2));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .card-inner{
      padding: 18px;
    }

    .grid{
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 14px;
      margin-top: 12px;
    }

    @media (max-width: 760px){
      .header{ flex-direction: column; align-items: flex-start; }
      .grid{ grid-template-columns: 1fr; }
    }

    .field{
      display: grid;
      gap: 7px;
    }
    label{
      font-size: 0.9rem;
      color: var(--muted);
    }
    input, select{
      width: 100%;
      padding: 11px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.18);
      color: var(--text);
      outline: none;
      transition: border-color .15s ease;
    }
    input::placeholder{ color: rgba(255,255,255,0.40); }
    input:focus, select:focus{
      border-color: rgba(124,92,255,0.9);
      box-shadow: 0 0 0 4px rgba(124,92,255,0.18);
    }

    .actions{
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 16px;
      align-items: center;
      justify-content: space-between;
    }

    .btn{
      appearance: none;
      border: 0;
      border-radius: 14px;
      padding: 12px 14px;
      cursor: pointer;
      font-weight: 650;
      letter-spacing: 0.01em;
      background: linear-gradient(135deg, rgba(124,92,255,0.95), rgba(0,196,255,0.80));
      color: white;
      box-shadow: 0 18px 45px rgba(124,92,255,0.25);
      transition: transform .08s ease, filter .15s ease;
      min-width: 190px;
    }
    .btn:hover{ filter: brightness(1.05); }
    .btn:active{ transform: translateY(1px); }

    .secondary{
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.14);
      box-shadow: none;
      min-width: 160px;
    }

    .hint{
      color: var(--muted2);
      font-size: 0.9rem;
      line-height: 1.4;
    }

    .status{
      font-size: 0.92rem;
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }
    .spin{
      width: 14px; height: 14px; border-radius: 50%;
      border: 2px solid rgba(255,255,255,0.25);
      border-top-color: rgba(255,255,255,0.85);
      display: none;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin{ to { transform: rotate(360deg); } }
    .error{ color: var(--bad); }

    .result-row{
      display: grid;
      gap: 10px;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid rgba(255,255,255,0.10);
    }

    .badge{
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.18);
      width: fit-content;
    }
    .badge strong{ font-size: 1.05rem; }

    .box{
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.18);
      color: rgba(255,255,255,0.86);
      overflow-x: auto;
      white-space: pre-wrap;
      line-height: 1.55;
    }

    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.88rem;
      white-space: pre;
    }

    .section-title{
      margin: 8px 0 6px 0;
      font-size: 0.95rem;
      color: rgba(255,255,255,0.88);
      font-weight: 650;
    }

    .two-col{
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 760px){
      .two-col{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <div>
        <h1 class="title">Sleep Disorder Predictor</h1>
        <p class="subtitle">
          This is a portfolio demo. It predicts <strong>None</strong>, <strong>Insomnia</strong>, or <strong>Sleep Apnea</strong>.
          The “Explain” feature uses SHAP + an LLM to describe why the model may have predicted the result.
          <strong>Educational only, not medical advice.</strong>
        </p>
      </div>

      <div class="pill" title="API must be running">
        <span class="dot"></span>
        API: http://127.0.0.1:8000
      </div>
    </div>

    <div class="card">
      <div class="card-inner">
        <div class="grid">
          <div class="field">
            <label for="Gender">Gender</label>
            <select id="Gender">
              <option>Male</option>
              <option>Female</option>
            </select>
          </div>

          <div class="field">
            <label for="Age">Age</label>
            <input id="Age" type="number" value="30" min="1" max="120" />
          </div>

          <div class="field">
            <label for="Occupation">Occupation</label>
            <input id="Occupation" placeholder="e.g., Engineer" value="Engineer" />
          </div>

          <div class="field">
            <label for="BMI_Category">BMI Category</label>
            <select id="BMI_Category">
              <option>Underweight</option>
              <option selected>Normal</option>
              <option>Overweight</option>
            </select>
          </div>

          <div class="field">
            <label for="Sleep_Duration">Sleep Duration (hours)</label>
            <input id="Sleep_Duration" type="number" step="0.1" value="7" min="0" max="24" />
          </div>

          <div class="field">
            <label for="Quality">Quality of Sleep (1–10)</label>
            <input id="Quality" type="number" value="7" min="1" max="10" />
          </div>

          <div class="field">
            <label for="Physical_Activity">Physical Activity (minutes/day)</label>
            <input id="Physical_Activity" type="number" value="45" min="0" />
          </div>

          <div class="field">
            <label for="Stress">Stress Level (1–10)</label>
            <input id="Stress" type="number" value="4" min="1" max="10" />
          </div>

          <div class="field">
            <label for="Heart_Rate">Heart Rate (bpm)</label>
            <input id="Heart_Rate" type="number" value="72" min="20" max="250" />
          </div>

          <div class="field">
            <label for="Daily_Steps">Daily Steps</label>
            <input id="Daily_Steps" type="number" value="8000" min="0" />
          </div>

          <div class="field">
            <label for="Systolic">Systolic</label>
            <input id="Systolic" type="number" value="120" min="50" max="250" />
          </div>

          <div class="field">
            <label for="Diastolic">Diastolic</label>
            <input id="Diastolic" type="number" value="80" min="30" max="200" />
          </div>
        </div>

        <div class="actions">
          <div style="display:flex; gap:10px; flex-wrap: wrap;">
            <button class="btn" onclick="predictExplain()">Predict + Explain</button>
            <button class="btn secondary" onclick="predictFast()">Predict Only</button>
          </div>

          <div class="status">
            <span class="spin" id="spin"></span>
            <span id="statusText" class="hint">Tip: Start API with <span class="mono">python -m uvicorn app:app --reload --port 8000</span></span>
          </div>
        </div>

        <div class="result-row">
          <div class="badge" id="badge" style="display:none;">
            <strong id="result">Prediction:</strong>
          </div>

          <div class="two-col" id="details" style="display:none;">
            <div>
              <div class="section-title">Probabilities</div>
              <div class="box mono" id="probs"></div>
            </div>

            <div>
              <div class="section-title">Top SHAP factors</div>
              <div class="box mono" id="shapBox"></div>
            </div>
          </div>

          <div id="explainWrap" style="display:none;">
            <div class="section-title">Explanation (SHAP + LLM)</div>
            <div class="box" id="explanation"></div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    const API_BASE = "http://127.0.0.1:8000";
    const PREDICT_URL = `${API_BASE}/predict`;
    const PREDICT_EXPLAIN_URL = `${API_BASE}/predict_with_explanation`;

    function setLoading(isLoading, text){
      document.getElementById("spin").style.display = isLoading ? "inline-block" : "none";
      const st = document.getElementById("statusText");
      st.classList.remove("error");
      st.textContent = isLoading ? (text || "Working...") : "Tip: Make sure your FastAPI server is running.";
    }

    function setError(msg){
      const st = document.getElementById("statusText");
      st.classList.add("error");
      st.textContent = msg;
    }

    function clearOutputs(){
      document.getElementById("badge").style.display = "none";
      document.getElementById("details").style.display = "none";
      document.getElementById("explainWrap").style.display = "none";

      document.getElementById("probs").textContent = "";
      document.getElementById("shapBox").textContent = "";
      document.getElementById("explanation").textContent = "";
    }

    function payloadFromForm(){
      return {
        Gender: document.getElementById("Gender").value,
        Age: Number(document.getElementById("Age").value),
        Occupation: document.getElementById("Occupation").value,
        BMI_Category: document.getElementById("BMI_Category").value,

        Sleep_Duration_hours: Number(document.getElementById("Sleep_Duration").value),
        Quality_of_Sleep: Number(document.getElementById("Quality").value),
        Physical_Activity_Level_minutes_day: Number(document.getElementById("Physical_Activity").value),
        Stress_Level: Number(document.getElementById("Stress").value),
        Heart_Rate_bpm: Number(document.getElementById("Heart_Rate").value),

        Daily_Steps: Number(document.getElementById("Daily_Steps").value),
        Systolic: Number(document.getElementById("Systolic").value),
        Diastolic: Number(document.getElementById("Diastolic").value),
      };
    }

    async function postJSON(url, payload){
      const res = await fetch(url, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload)
      });
      const data = await res.json().catch(() => ({}));
      if(!res.ok){
        const detail = data?.detail ? String(data.detail) : `Request failed (${res.status})`;
        throw new Error(detail);
      }
      return data;
    }

    function renderPrediction(pred){
      document.getElementById("badge").style.display = "inline-flex";
      document.getElementById("result").textContent = `Prediction: ${pred ?? "Unknown"}`;
    }

    function renderProbabilities(probs){
      if(!probs) return;
      document.getElementById("details").style.display = "grid";
      document.getElementById("probs").textContent = JSON.stringify(probs, null, 2);
    }

    function renderShapFactors(factors){
      if(!factors) return;
      document.getElementById("details").style.display = "grid";
      document.getElementById("shapBox").textContent = JSON.stringify(factors, null, 2);
    }

    function renderExplanation(text){
      if(!text) return;
      document.getElementById("explainWrap").style.display = "block";
      document.getElementById("explanation").textContent = text;
    }

    async function predictFast(){
      clearOutputs();
      setLoading(true, "Predicting...");

      try{
        const payload = payloadFromForm();
        const data = await postJSON(PREDICT_URL, payload);

        renderPrediction(data.prediction);
        renderProbabilities(data.probabilities);

        setLoading(false);
      } catch (e){
        setError(`Could not predict: ${e.message}. Is the API running at ${API_BASE}?`);
        setLoading(false);
      }
    }

    async function predictExplain(){
      clearOutputs();
      setLoading(true, "Predicting + generating explanation...");

      try{
        const payload = payloadFromForm();
        const data = await postJSON(PREDICT_EXPLAIN_URL, payload);

        renderPrediction(data.prediction);
        renderProbabilities(data.probabilities);
        renderShapFactors(data.top_shap_factors);
        renderExplanation(data.explanation);

        setLoading(false);
      } catch (e){
        setError(`Could not predict/explain: ${e.message}. Check API logs for details.`);
        setLoading(false);
      }
    }
  </script>
</body>
</html>
